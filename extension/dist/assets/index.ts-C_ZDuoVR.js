class r{constructor(e){this.storage=e}async analyzeDomain(e){let t=0;const a=[];return await this.storage.isWhitelisted(e)?{score:0,factors:["whitelisted"]}:(e.split(".").length>3&&(t+=20,a.push("subdomain_depth")),(e.includes("login")||e.includes("verify"))&&(t+=10,a.push("suspicious_keyword")),{score:t,factors:a})}async recalculateRisk(e,t){let a=0;const n=[];return t.hasSensitiveInput&&(a+=20,n.push("sensitive_input")),t.hasFakeBadge&&(a+=50,n.push("fake_trust_badge")),t.hasUrgencyText&&(a+=30,n.push("urgency_text")),a=Math.min(100,a),{score:a,factors:n}}}class c{async enableSafeStart(e){console.log(`[RuleManager] Safe-Start enabled for tab ${e} (Simulated)`)}async disableSafeStart(e){console.log(`[RuleManager] Safe-Start disabled for tab ${e}`)}}class l{async isWhitelisted(e){return((await chrome.storage.local.get("whitelist")).whitelist||[]).includes(e)}async addToCache(e,t){}}const d=new l,i=new c,o=new r(d);chrome.webNavigation.onCommitted.addListener(async s=>{if(s.frameId!==0)return;const e=s.tabId,t=new URL(s.url);console.log(`[SentinelTK] Navigating to ${t.hostname}`),await i.enableSafeStart(e);const a=await o.analyzeDomain(t.hostname);a.score<40?(await i.disableSafeStart(e),chrome.action.setBadgeText({tabId:e,text:""})):a.score>=40&&a.score<70?(await i.disableSafeStart(e),chrome.action.setBadgeText({tabId:e,text:"!"}),chrome.action.setBadgeBackgroundColor({tabId:e,color:"#f59e0b"})):(chrome.action.setBadgeText({tabId:e,text:"XXX"}),chrome.action.setBadgeBackgroundColor({tabId:e,color:"#ef4444"}),chrome.scripting.executeScript({target:{tabId:e},files:["src/content/overlay.js"]}))});chrome.runtime.onMessage.addListener((s,e)=>{var t;s.type==="PAGE_SIGNALS"&&u((t=e.tab)==null?void 0:t.id,s.data)});async function u(s,e){if(!s)return;(await o.recalculateRisk(s,e)).score>=70&&chrome.tabs.sendMessage(s,{type:"RISK_ACTION",action:"BLOCK_FORM"})}chrome.runtime.onInstalled.addListener(()=>{console.log("SentinelTK Installed")});
